---
title: "prep_data"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
# https://rdatatable.gitlab.io/data.table/articles/datatable-intro.html
# https://richarddmorey.github.io/BayesFactor/
rm(list = ls())
library(data.table); library(tidyverse); library(rIP)
source("utils_feed.R")
source("creds.R")
```


```{r}
d0 <- fread("../data/clean/data.csv")
d0 <- d0[attention == 1.0 & ipblock == 0]
d0[, n_distinct(user_id), keyby = .(condition, attention, ipblock)]
d0[, n_distinct(user_id)]
d0[, n_distinct(user_id), condition]
users_complete <- unique(d0$user_id)
```


```{r}
d0_all <- fread("../data/raw/e0j5KD_user_form.csv")
d0_all <- d0_all[!grepl("test", user_id)]
users_all <- d0_all[response == "feed-landed", .N, by = .(user_id)][N == 1, user_id]
users_intersctt<-intersect(users_all, users_complete)

users_quit <- setdiff(users_all, users_complete)

d0_quitter <- d0_all[user_id %in% users_quit]
d0_quitter <- d0_quitter[field == "condition"]

d0_intersctt <- d0_all[user_id %in% users_intersctt]
d0_intersctt <- d0_intersctt[field == "condition"]


prop.test(c(n_distinct(d0_quitter[response == 2]), n_distinct(d0_quitter[response == 1])), c(n_distinct(d0_intersctt[response == 2])+n_distinct(d0_quitter[response == 2]), n_distinct(d0_intersctt[response == 1])+n_distinct(d0_quitter[response == 1])))

```
