---
title: "prep_data"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
# https://rdatatable.gitlab.io/data.table/articles/datatable-intro.html
# https://richarddmorey.github.io/BayesFactor/
rm(list = ls())
library(data.table); library(tidyverse); library(rIP)
source("utils_feed.R")
source("creds.R")
```


```{r}
d0 <- fread("../data/clean/data.csv")
d0 <- d0[attention == 1.0 & ipblock == 0]
d0[, n_distinct(user_id), keyby = .(condition, attention, ipblock)]
users_complete <- d0[, unique(user_id)]
complete_prop <- d0[, .(complete = n_distinct(user_id)), condition][order(condition)]
complete_prop
```


```{r}
d0_all <- fread("../data/raw/e0j5KD_engagement.csv")
d0_all <- d0_all[!grepl("test", user_id)]
users_all <- distinct(d0_all[, .(user_id, condition)])
users_all <- users_all$user_id
all_prop <- d0_all[, .(all = n_distinct(user_id)), condition][order(condition)]
all_prop
all_prop[, condition := ifelse(condition == 1, -0.5, 0.5)]
all_prop

setdiff(users_all, users_complete)  # didn't complete people
setdiff(users_complete, users_all)  # nothing, good

complete_prop
all_prop
prop.test(complete_prop$complete, all_prop$all)
```
