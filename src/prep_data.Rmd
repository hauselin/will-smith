---
title: "prep_data"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
# https://rdatatable.gitlab.io/data.table/articles/datatable-intro.html
# https://richarddmorey.github.io/BayesFactor/
rm(list = ls())
library(data.table); library(tidyverse)
```

```{r}
d0 <- fread("../data/raw/eNKqay_user_form.csv")
```

```{r}
d0[, n_distinct(user_id)]
d0[, unique(field)]
d0
```

```{r}
d1 <- d0[field == "politicalpref", .(user_id, response)][response != ""]
d1[, n_distinct(user_id)]
d1[, unique(response)]

d1[, unique(response)] |> sort()

d1[, response_num := substr(response, 1, 1)]
d1[, response_num := as.numeric(response_num)]
glimpse(d1)


```

```{r}

d2 <- fread("../data/raw/eNKqay_engagement.csv")
d2[, n_distinct(user_id)]
d2[, unique(user_id)]
d2[, n_distinct(entity_id)]
d2[, unique(entity_id)]

glimpse(d2)

d3 <- d2[, .(user_id, condition)][condition != "null"]

glimpse(d3)

d3[, condition := as.numeric(condition)]

d3[, unique(user_id)]

d3 <- unique(d3)

a <- d1$user_id
b <- d3$user_id

intersect(a, b)

d4 <- merge(x = d1, y = d3, by = "user_id")

fwrite(d4, file = "../data/clean/merged_cleaned_data.csv")

```

